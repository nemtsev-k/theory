# React

## Flux-архитектура

Глобальное состояние приложения — это часть состояния приложения, которое используется и изменяется в разных компонентах этого приложения.

Для управления глобальным состоянием существуют разные подходы. Одним из них является паттерн Flux, который подразумевает отделение состояния от дерева компонентов и односторонний поток данных. В рамках этого подхода изменять состояние может только специальная сущность — Диспетчер. Компоненты же, или Представление, только читают данные из Хранилища, а если нужно изменить состояние, то формируют Действие и передают его Диспетчеру.

## Redux

Redux — это библиотека на JavaScript, которая реализует паттерн Flux.

Redux нужен:

* требуется часто синхронизировать состояние между многими компонентами;
* постоянно приходится контролировать изменение состояния во времени — time travel debug;
* приходится перехватывать и вмешиваться в процесс изменения состояния, используя middleware.

Redux не зависит от фреймворков и библиотек, его можно использовать и без React.

### Структура

Важными сущностями Redux являются Действие — action, Хранилище — store и чистая функция reducer, взаимодействие с которой происходит с помощью метода store.dispatch().

* action - это объект Действие.
* dispatch - это метод, который предоставляет Хранилище, в которое передаётся Действие.
* reducer - это функция, которую разработчик сам пишет и передаёт её в Redux в момент создания Хранилища.
* store - это Хранилище

### Взаимодействие Redux с React

* Provider – компонент позволяет подключить к Хранилищу Redux дочерние компоненты. Хранилище передаётся в виде пропса store.
* useSelector – хук позволяет компоненту получить данные из Хранилища.
* useDispatch - хук позволяет получить доступ к методу store.dispatch(), чтобы диспатчить Действия из компонентов.
* connect() - функция для взаимодействия с Хранилищем из классовых компонентов React.

## Middleware

* Повторное использование. Middleware — это отдельная программа, а значит единожды написанный посредник может быть переиспользован в различных местах системы и даже в разных системах.
* Быстрое внедрение. Middleware написать проще, чем переработать систему целиком.
* Бесшовное внедрение разнородных систем. С помощью middleware в продукте можно использовать абсолютно разнородные системы.
* Экономическая эффективность. По причине первых трёх пунктов и ещё с десятка других.

### Middleware в Redux

Хотя в Redux middleware так же остаются верными перечисленные концепции, они решают несколько иную проблему. Посредник в Redux необходим для того, чтобы в момент между тем, как мы бросили экшен и его обработал редьюсер, можно было совершить какие-либо действия. Middleware — простой способ расширить функциональность Redux. Не нужно ждать, пока разработчики Redux добавят поддержку тех или иных функций, многие из них можно реализовать самостоятельно с помощью механизма middleware.

### Redux Thunk

Redux Thunk - middleware для Redux. С помощью этой функции можно расширить функциональность Redux, получая возможность отправлять (диспатчить) не только объекты, описывающие действия, но и функции. В них можно разместить код с побочными эффектами.

### Оптимизация

**Что оптимизировать?**

* **Производительность.** Мы можем оптимизировать производительность, чтобы приложение стало более быстрым и отзывчивым для конечного пользователя.
* **Код.** Вести и придерживаться стиля кодирования, чтобы вашим коллегам было проще разобраться в коде, написанном вами, и наоборот. Потому что если код будет простым и понятным, его будет проще (оптимальнее) поддерживать и дорабатывать. Плюс, ваш технический долг будет увеличиваться существенно медленнее.
* **Процессы.** Имеются ввиду процессы в команде. Это и постановка задач, и ревью кода и всё остальное. Например, чтобы ускорить проверку домашних заданий, вы можете договориться с наставником о конкретном и регулярном времени проверки. Тогда вы будете знать в какое именно время стоит отправлять свою работу, а наставник сможет её регулярно проверять.

**Сложности оптимизации**

* **Производительность кода обратно пропорциональна его читабельности.** Об этом нужно помнить всякий раз, когда вы хотите использовать !!value вместо Boolean(value), вложенный тернарный оператор вместо if, оператор ~ вместо сравнения на меньше нуля и т. д.
* **Оптимизация требует анализа.** «Нельзя просто так взять и» оптимизировать приложение или его код. Прежде необходимо провести анализ и выявить неоптимальные участки. После продумать стратегию оптимизации. И только потом уже предпринимать какие-либо действия.
* **Преждевременная оптимизация — зло.** Оптимизировать что-либо без запроса на эту самую оптимизацию, например, отзывов пользователей, это напрасная трата времени в данный момент.

Когда нужно оптимизировать производительность?

* Когда о проблеме производительности будут писать пользователи
* Проверка с помощью специальных инструментов

**Анализаторы**

* Dynatrace Application Monitoring. Инструмент для мониторинга приложения целиком. От бэкенда до фронтенда.
* PageSpeed Insights. Анализатор конкретной страницы вашего приложения.

**Профайлеры**

* Chrome DevTools или Firefox DevTools. Вкладка Perfomance (Производительность).
* React Profiler — часть React DevTools. Профайлер, похожий на встроенный браузерный, только заточенный под React:
  * React Profiler для Chrome.
  * React Profiler для Firefox.

**Полезные инструменты консоли**

* Обложить ту часть приложения, производительность которой необходимо замерить, вызовами console.time.
* Или, ещё лучше, обложив window.perfomance (Perfomance API).

**Способы оптимизации**

* **Упрощайте код и выбрасывайте из него всё лишнее.** Это не значит, что в угоду оптимизации нужно избавляться от части функциональности. Например, большой и сложный компонент нужно не выбрасывать, а разделить на несколько маленьких и простых.
* **Применяйте известные паттерны.** Любые паттерны возникают в момент решения часто встречающихся проблем и проверяются временем и делом. Поэтому старайтесь использовать чужой опыт, а не наступать на свои грабли.
* **Изучайте новые паттерны.** Это поможет не попасть в анекдотичную ситуацию, известную как «золотой молоток».
